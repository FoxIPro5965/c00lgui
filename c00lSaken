local Players=game:GetService("Players")
local ReplicatedStorage=game:GetService("ReplicatedStorage")
local RunService=game:GetService("RunService")
local Lighting=game:GetService("Lighting")
local lp=Players.LocalPlayer
local PlayerGui=lp:WaitForChild("PlayerGui")

local attackIds = {
    ["126830014841198"]=true,["126355327951215"]=true,["121086746534252"]=true,
    ["18885909645"]=true,["98456918873918"]=true,["105458270463374"]=true,
    ["83829782357897"]=true,["125403313786645"]=true,["118298475669935"]=true,
    ["82113744478546"]=true,["70371667919898"]=true,["99135633258223"]=true,
    ["97167027849946"]=true,["109230267448394"]=true,["139835501033932"]=true,
    ["126896426760253"]=true,["109667959938617"]=true,["126681776859538"]=true,
    ["129976080405072"]=true,["121293883585738"]=true,["81639435858902"]=true,
    ["137314737492715"]=true,["92173139187970"]=true,["122709416391"]=true,
    ["879895330952"]=true,
}

local Rayfield=loadstring(game:HttpGet("https://sirius.menu/rayfield"))()
local Window=Rayfield:CreateWindow({
    Name="c00lSaken",
    LoadingTitle="c00lSaken",
    LoadingSubtitle="by FoxOfficial",
    ConfigurationSaving={Enabled=true,FolderName="c00lSaken",FileName="Config"},
    KeySystem=false
})

local AutoBlockTab=Window:CreateTab("Autoblock",4483362458)
local BackstabTab=Window:CreateTab("AutoBackstab",4483362458)
local VisualTab=Window:CreateTab("Visuals",4483362458)
local OtherTab=Window:CreateTab("Other",4483362458)

-- ===== VARIABLES =====
local autoBlockOn=false
local detectionRange=12
local strictRangeOn=false
local facingCheckEnabled=true

local autoBlockMode="Block" -- Block | Clone

local backstab=false
local backstabRange=8
local backstabMode="Around"
local dashStab=false

local visualEnabled=false
local showKiller=false
local showSurvivor=false
local showItems=false
local showGen=false

local infStamina=false
local jumpEnabled=false
local hitbox=false
local HitboxModule
local autoGen=false
local autoGenSpeed=0.115
local undetectedMode=false

-- ===== UI =====
AutoBlockTab:CreateToggle({Name="Autoblock",Callback=function(v)autoBlockOn=v end})
AutoBlockTab:CreateInput({Name="Range",PlaceholderText="12",Callback=function(v)detectionRange=tonumber(v)or detectionRange end})
AutoBlockTab:CreateToggle({Name="Strict Range",Callback=function(v)strictRangeOn=v end})
AutoBlockTab:CreateToggle({Name="Facing Check",Callback=function(v)facingCheckEnabled=v end})
AutoBlockTab:CreateDropdown({
    Name="Mode",
    Options={"Block","Clone"},
    CurrentOption="Block",
    Callback=function(v)autoBlockMode=v end
})

BackstabTab:CreateToggle({Name="AutoBackstab",Callback=function(v)backstab=v end})
BackstabTab:CreateToggle({Name="DashStab",Callback=function(v)dashStab=v end})
BackstabTab:CreateInput({Name="Range",PlaceholderText="8",Callback=function(v)backstabRange=tonumber(v)or backstabRange end})
BackstabTab:CreateDropdown({Name="Mode",Options={"Behind","Around"},CurrentOption="Around",Callback=function(v)backstabMode=v end})

VisualTab:CreateToggle({Name="Highlight",Callback=function(v)visualEnabled=v end})
VisualTab:CreateToggle({Name="Killer",Callback=function(v)showKiller=v end})
VisualTab:CreateToggle({Name="Survivor",Callback=function(v)showSurvivor=v end})
VisualTab:CreateToggle({Name="Generator",Callback=function(v)showGen=v end})
VisualTab:CreateToggle({Name="Medkit & BloxyCola",Callback=function(v)showItems=v end})

OtherTab:CreateToggle({Name="INF STAMINA",Callback=function(v)infStamina=v end})
OtherTab:CreateToggle({Name="Jump",Callback=function(v)jumpEnabled=v end})
OtherTab:CreateToggle({
    Name="Hitbox",
    Callback=function(v)
        hitbox=v
        if v then
            HitboxModule=HitboxModule or loadstring(game:HttpGet("https://raw.githubusercontent.com/FoxIPro5965/c00lgui/main/Hitbox.lua"))()
            HitboxModule:ExtendHitbox(1.15,600)
        elseif HitboxModule then
            HitboxModule:StopExtendingHitbox()
        end
    end
})
OtherTab:CreateToggle({Name="Auto gen",Callback=function(v)autoGen=v end})
OtherTab:CreateSlider({Name="Gen Speed",Range={0.01,0.5},Increment=0.005,CurrentValue=0.115,Callback=function(v)autoGenSpeed=v end})
OtherTab:CreateToggle({Name="Undetected Mode",Callback=function(v)undetectedMode=v end})

local function clickSkill(name)
    local ui=PlayerGui:FindFirstChild("MainUI")
    local c=ui and ui:FindFirstChild("AbilityContainer")
    local btn=c and c:FindFirstChild(name)
    if not btn then return end
    for _,con in ipairs(getconnections(btn.MouseButton1Click))do pcall(function()con:Fire()end)end
    pcall(function()btn:Activate()end)
end

-- ===== AUTOBLOCK =====
local checked={}
local function detectAttack(char)
    if checked[char] then return false end
    local hum=char:FindFirstChildOfClass("Humanoid")
    if hum then
        for _,tr in ipairs(hum:GetPlayingAnimationTracks())do
            local id=tr.Animation and tr.Animation.AnimationId:match("%d+")
            if id and attackIds[id] then
                checked[char]=true
                task.delay(0.08,function()checked[char]=nil end)
                return true
            end
        end
    end
end

RunService.RenderStepped:Connect(function()
    if not autoBlockOn then return end
    local char=lp.Character
    local root=char and char:FindFirstChild("HumanoidRootPart")
    if not root then return end

    for _,p in ipairs(Players:GetPlayers())do
        if p~=lp and p.Character then
            local r=p.Character:FindFirstChild("HumanoidRootPart")
            local h=p.Character:FindFirstChildOfClass("Humanoid")
            if r and h and h.Health>0 then
                if (r.Position-root.Position).Magnitude<=detectionRange then
                    if detectAttack(p.Character) then
                        if autoBlockMode=="Clone" then
                            clickSkill("Clone")
                        else
                            clickSkill("Block")
                        end
                    end
                end
            end
        end
    end
end)

-- ===== AUTO BACKSTAB (CONTINUOUS TP VERSION) =====

local killersFolder = workspace:WaitForChild("Players"):WaitForChild("Killers")

local lastBackstab = 0
local COOLDOWN = 10
local HOLD_TIME = 2.9
local TP_DIST = 2.5

local function validKiller(k)
    local hum = k:FindFirstChildOfClass("Humanoid")
    local hrp = k:FindFirstChild("HumanoidRootPart")
    return hum and hrp and hum.Health > 0
end

local function inRange(hrp, khrp)
    return (hrp.Position - khrp.Position).Magnitude <= backstabRange
end

local function behindOrAround(hrp, khrp)
    if backstabMode == "Around" then
        return true
    end
    return (hrp.Position - khrp.Position):Dot(-khrp.CFrame.LookVector) > 0.5
end

local function tpBehind(hrp, khrp)
    hrp.CFrame = CFrame.new(
        khrp.Position - khrp.CFrame.LookVector * TP_DIST,
        khrp.Position
    )
end

RunService.Heartbeat:Connect(function()
    if not backstab then return end
    if tick() - lastBackstab < COOLDOWN then return end

    local char = lp.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    for _, killer in ipairs(killersFolder:GetChildren()) do
        if validKiller(killer) then
            local khrp = killer.HumanoidRootPart

            if inRange(hrp, khrp) and behindOrAround(hrp, khrp) then
                lastBackstab = tick()

                -- DASHSTAB
                if dashStab then
                    clickSkill("Crouch")
                    task.wait(0.02)
                end
                clickSkill("Dagger")
                local start = tick()
                local conn
                conn = RunService.Heartbeat:Connect(function()
                    if tick() - start >= HOLD_TIME then
                        conn:Disconnect()
                        return
                    end
                    if hrp and khrp then
                        tpBehind(hrp, khrp)
                    end
                end)

                break
            end
        end
    end
end)

local oldA,oldO,oldB,oldF=Lighting.Ambient,Lighting.OutdoorAmbient,Lighting.Brightness,Lighting.FogEnd
local function bright(on)
if on then
Lighting.Ambient=Color3.new(1,1,1)
Lighting.OutdoorAmbient=Color3.new(1,1,1)
Lighting.Brightness=6
Lighting.FogEnd=0
else
Lighting.Ambient=oldA
Lighting.OutdoorAmbient=oldO
Lighting.Brightness=oldB
Lighting.FogEnd=oldF
end
end

local function addHL(obj,color)
if obj:FindFirstChild("VisualHL")then return end
local h=Instance.new("Highlight")
h.Name="VisualHL"
h.FillTransparency=1
h.OutlineTransparency=0
h.OutlineColor=color
h.Parent=obj
h.Adornee=obj
end

local function clearVisual()
for _,v in ipairs(workspace:GetDescendants())do
if v:IsA("Highlight")and v.Name=="VisualHL"then v:Destroy()end
end
end

task.spawn(function()
while task.wait(0.6)do
if not visualEnabled then clearVisual()bright(false)continue end
bright(true)
clearVisual()
local pf=workspace:FindFirstChild("Players")
if pf then
if showKiller and pf:FindFirstChild("Killers")then
for _,k in ipairs(pf.Killers:GetChildren())do
if k:FindFirstChild("Humanoid")then addHL(k,Color3.fromRGB(255,70,70))end
end
end
if showSurvivor and pf:FindFirstChild("Survivors")then
for _,s in ipairs(pf.Survivors:GetChildren())do
if s:FindFirstChild("Humanoid")then addHL(s,Color3.fromRGB(70,255,70))end
end
end
end
if showItems then
for _,i in ipairs(workspace:GetDescendants())do
if i.Name=="Medkit"or i.Name=="BloxyCola"then addHL(i,Color3.fromRGB(180,0,255))end
end
end
if showGen then
for _,g in ipairs(workspace:GetDescendants())do
if g.Name:lower():find("generator")then addHL(g,Color3.fromRGB(255,255,0))end
end
end
end
end)

task.spawn(function()
local Undetectable=require(ReplicatedStorage.Modules.StatusEffects.Undetectable)
local animationId="rbxassetid://75804462760596"
local loadedAnim=nil
local function play(char)
local hum=char and char:FindFirstChildOfClass("Humanoid")
if hum then
local anim=Instance.new("Animation")
anim.AnimationId=animationId
loadedAnim=hum:LoadAnimation(anim)
loadedAnim:Play()
loadedAnim:AdjustSpeed(0)
end
end
local function stop()
if loadedAnim then loadedAnim:Stop() loadedAnim=nil end
end
local oA=Undetectable.Applied
local oR=Undetectable.Removed
Undetectable.Applied=function(d)
if undetectedMode and d.Player==lp then play(d.Character or d.Player.Character) end
return oA(d)
end
Undetectable.Removed=function(d)
if undetectedMode and d.Player==lp then stop() end
return oR(d)
end
end)

local FlowGameModule
local oldNew
local hookedGen=false

local function isNeighbour(r1,c1,r2,c2)
if r2==r1-1 and c2==c1 then return true end
if r2==r1+1 and c2==c1 then return true end
if r2==r1 and c2==c1-1 then return true end
if r2==r1 and c2==c1+1 then return true end
return false
end

local function key(n)
return n.row.."-"..n.col
end

local function orderPath(path,endpoints)
if not path or #path==0 then return path end
local start=endpoints and endpoints[1] or path[1]
local pool={}
for _,n in ipairs(path)do pool[key(n)]={row=n.row,col=n.col}end
local ordered={}
local cur={row=start.row,col=start.col}
table.insert(ordered,cur)
pool[key(cur)]=nil
while next(pool)do
local found=false
for k,n in pairs(pool)do
if isNeighbour(cur.row,cur.col,n.row,n.col)then
table.insert(ordered,n)
pool[k]=nil
cur=n
found=true
break
end
end
if not found then break end
end
return ordered
end

local HintSystem={}
function HintSystem:Draw(puzzle)
if not puzzle or not puzzle.Solution then return end
for i=1,#puzzle.Solution do
local path=puzzle.Solution[i]
local ends=puzzle.targetPairs[i]
local ordered=orderPath(path,ends)
puzzle.paths[i]={}
for _,node in ipairs(ordered)do
if not autoGen then return end
table.insert(puzzle.paths[i],{row=node.row,col=node.col})
puzzle:updateGui()
task.wait(autoGenSpeed)
end
puzzle:checkForWin()
end
end

local function hookAutoGen()
if hookedGen then return end
local mod=ReplicatedStorage.Modules.Misc.FlowGameManager.FlowGame
FlowGameModule=require(mod)
oldNew=oldNew or FlowGameModule.new
FlowGameModule.new=function(...)
local puzzle=oldNew(...)
task.spawn(function()
if autoGen then HintSystem:Draw(puzzle) end
end)
return puzzle
end
hookedGen=true
end

hookAutoGen()

task.spawn(function()
local sprint=require(ReplicatedStorage.Systems.Character.Game.Sprinting)
while task.wait(1)do
if infStamina then sprint.Stamina=sprint.MaxStamina or 100 end
end
end)

task.spawn(function()
while task.wait(0.2)do
local hum=lp.Character and lp.Character:FindFirstChildOfClass("Humanoid")
if hum then hum.JumpPower=jumpEnabled and 60 or 0 end
end
end)
