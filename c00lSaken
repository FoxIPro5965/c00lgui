local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local Lighting = game:GetService("Lighting")
local VirtualInputManager = game:GetService("VirtualInputManager")
local lp = Players.LocalPlayer
local PlayerGui = lp:WaitForChild("PlayerGui")

local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()
local Window = Rayfield:CreateWindow({
    Name = "c00lSaken",
    LoadingTitle = "c00lSaken Script",
    LoadingSubtitle = "by Fox",
    ConfigurationSaving = {Enabled = true, FolderName = "c00lSaken", FileName = "Settings"},
    Discord = {Enabled = false},
    KeySystem = false
})

local AutoBlockTab = Window:CreateTab("Auto Block", 4483362458)
local AutoBackstabTab = Window:CreateTab("Auto Backstab", 4483362458)
local OtherTab = Window:CreateTab("Other", 4483362458)

local attackIds = {
["126830014841198"]=true,["126355327951215"]=true,["121086746534252"]=true,["18885909645"]=true,
["98456918873918"]=true,["105458270463374"]=true,["83829782357897"]=true,["125403313786645"]=true,
["118298475669935"]=true,["82113744478546"]=true,["70371667919898"]=true,["99135633258223"]=true,
["97167027849946"]=true,["109230267448394"]=true,["139835501033932"]=true
}

local autoBlock=false
local autoPunch=false
local aimPunch=false
local range=12
local prediction=0.8

local autoBackstab=false
local backstabRange=8
local cooldown=false

local espEnabled=false
local espObjects={}

local autoGen=false
local genDelay=2.5
local anti1xpop=false

local killersFolder=workspace:WaitForChild("Players"):WaitForChild("Killers")

AutoBlockTab:CreateToggle({Name="Autoblock",CurrentValue=false,Callback=function(v)autoBlock=v end})
AutoBlockTab:CreateToggle({Name="Auto Punch",CurrentValue=false,Callback=function(v)autoPunch=v end})
AutoBlockTab:CreateToggle({Name="Aim Punch",CurrentValue=false,Callback=function(v)aimPunch=v end})
AutoBlockTab:CreateInput({Name="Range",PlaceholderText="12",Callback=function(t)range=tonumber(t)or range end})
AutoBlockTab:CreateSlider({Name="Prediction",Range={0,10},Increment=0.1,CurrentValue=0.8,Callback=function(v)prediction=v end})

AutoBackstabTab:CreateToggle({Name="Auto Backstab",CurrentValue=false,Callback=function(v)autoBackstab=v end})
AutoBackstabTab:CreateInput({Name="Backstab Range",PlaceholderText="8",Callback=function(t)backstabRange=tonumber(t)or backstabRange end})

OtherTab:CreateToggle({
    Name="ESP",
    CurrentValue=false,
    Callback=function(v)
        espEnabled=v
        if not v then
            for _,h in ipairs(espObjects) do pcall(function()h:Destroy()end) end
            table.clear(espObjects)
        end
    end
})

OtherTab:CreateToggle({Name="Auto Generator",CurrentValue=false,Callback=function(v)autoGen=v end})
OtherTab:CreateSlider({Name="Gen Delay",Range={0.5,10},Increment=0.1,CurrentValue=2.5,Callback=function(v)genDelay=v end})
OtherTab:CreateButton({
    Name="Instant Solve Generator",
    Callback=function()
        for _,g in pairs(workspace.Map.Ingame.Map:GetChildren()) do
            if g.Name=="Generator" then
                for i=1,4 do
                    g:WaitForChild("Remotes"):WaitForChild("RE"):FireServer()
                end
            end
        end
    end
})

OtherTab:CreateToggle({Name="Anti 1x1x1x1 Popup",CurrentValue=false,Callback=function(v)anti1xpop=v end})

local function clearESP()
    for _,h in ipairs(espObjects) do pcall(function()h:Destroy()end) end
    table.clear(espObjects)
end

local function addESP(obj,f,o)
    if not obj or not obj:IsDescendantOf(workspace) then return end
    local h=Instance.new("Highlight")
    h.Adornee=obj
    h.FillColor=f
    h.OutlineColor=o
    h.FillTransparency=0.6
    h.Parent=obj
    table.insert(espObjects,h)
end

task.spawn(function()
    while task.wait(1) do
        if not espEnabled then continue end
        clearESP()
        local pf=workspace:FindFirstChild("Players")
        if not pf then continue end
        for _,k in pairs(pf.Killers:GetChildren()) do
            if k:FindFirstChild("Humanoid") then
                addESP(k,Color3.fromRGB(255,50,50),Color3.fromRGB(255,0,0))
            end
        end
        for _,s in pairs(pf.Survivors:GetChildren()) do
            if s:FindFirstChild("Humanoid") then
                addESP(s,Color3.fromRGB(50,255,50),Color3.fromRGB(0,255,0))
            end
        end
        for _,i in pairs(workspace:GetDescendants()) do
            if i:IsA("Tool") and (i.Name:lower():find("med") or i.Name:lower():find("cola")) then
                addESP(i.Handle or i,Color3.fromRGB(80,80,255),Color3.fromRGB(0,0,255))
            end
        end
    end
end)

task.spawn(function()
    while task.wait(genDelay) do
        if not autoGen then continue end
        for _,g in pairs(workspace.Map.Ingame.Map:GetChildren()) do
            if g.Name=="Generator" then
                local p=g:FindFirstChildOfClass("ProximityPrompt")
                if p then fireproximityprompt(p) end
            end
        end
    end
end)

task.spawn(function()
    while task.wait(0.1) do
        if not anti1xpop then continue end
        local gui=lp.PlayerGui:FindFirstChild("TemporaryUI")
        if not gui then continue end
        for _,p in pairs(gui:GetChildren()) do
            if p.Name=="1x1x1x1Popup" then
                local x=p.AbsolutePosition.X+p.AbsoluteSize.X/2
                local y=p.AbsolutePosition.Y+p.AbsoluteSize.Y/2
                VirtualInputManager:SendMouseButtonEvent(x,y,0,true,game,0)
                VirtualInputManager:SendMouseButtonEvent(x,y,0,false,game,0)
            end
        end
    end
end)

RunService.RenderStepped:Connect(function()
    local char=lp.Character
    local hrp=char and char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    if autoBlock then
        for _,p in pairs(Players:GetPlayers()) do
            if p~=lp and p.Character then
                local r=p.Character:FindFirstChild("HumanoidRootPart")
                local h=p.Character:FindFirstChild("Humanoid")
                if r and h and h.Health>0 and (r.Position-hrp.Position).Magnitude<=range then
                    for _,t in pairs(h:GetPlayingAnimationTracks()) do
                        local id=t.Animation and t.Animation.AnimationId:match("%d+")
                        if id and attackIds[id] then
                            PlayerGui.MainUI.AbilityContainer.Block:Activate()
                        end
                    end
                end
            end
        end
    end

    if autoBackstab and not cooldown then
        for _,k in pairs(killersFolder:GetChildren()) do
            local r=k:FindFirstChild("HumanoidRootPart")
            if r and (r.Position-hrp.Position).Magnitude<=backstabRange then
                cooldown=true
                hrp.CFrame=CFrame.new(r.Position-r.CFrame.LookVector*0.4,r.Position)
                PlayerGui.MainUI.AbilityContainer.Dagger:Activate()
                task.delay(0.4,function()cooldown=false end)
                break
            end
        end
    end
end)
